<!DOCTYPE html>
<html lang="en">
<head>
 <title>Frederik Braun: New CSP directive to make Subresource Integrity mandatory (`require-sri-for`)</title>
 <meta charset="utf-8" />
 <meta name="viewport" content="width=device-width, initial-scale=1">
 <link rel="stylesheet" href="/theme/css/main.css" type="text/css" />
 <link rel="icon" href='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 100 200"><style>svg{background-color:%231f54a6;}text{fill:white;font-family:Georgia,Cambria,"Times New Roman",Times,serif;}</style><text y="1.2em" font-size="135">F</text></svg>'>
 <link href="https://vaurenw.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Frederik Braun ATOM Feed" />
 <link href="https://vaurenw.github.io/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Frederik Braun RSS Feed" />
 <meta property="og:site_name" content="Frederik Braun"/>
 <meta property="og:type" content="website"/>
 <meta name="twitter:card" content="summary"/>
 <meta name="description" content="New CSP directive to make Subresource Integrity mandatory (`require-sri-for`)" />
 <meta property="og:title" content="New CSP directive to make Subresource Integrity mandatory (`require-sri-for`)"/>
 <meta property="og:url" content="https://vaurenw.github.io/new-csp-directive-to-make-subresource-integrity-mandatory-require-sri-for.html"/>
 <meta name="twitter:title" content="New CSP directive to make Subresource Integrity mandatory (`require-sri-for`)" />
 <meta name="fediverse:author" content="@freddy@security.plumbing" />
 <link rel="canonical" href="https://vaurenw.github.io/new-csp-directive-to-make-subresource-integrity-mandatory-require-sri-for.html"/>
</head>

<body>
<header class="site-header" role="banner">
<div class="wrapper"><a class="site-title" rel="author" href="/">Frederik Braun</a><nav class="site-nav">
  <input type="checkbox" id="nav-trigger" class="nav-trigger">
  <label for="nav-trigger">
  <span class="menu-icon">
    <svg viewBox="0 0 18 15" width="18px" height="15px">
      <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"></path>
    </svg>
  </span>
  </label>
  <div class="trigger">
    <a class="page-link" href="https://vaurenw.github.io/archives.html">Blog</a>
    <a class="page-link" href="https://vaurenw.github.io/pages/publications.html">Portfolio</a>
    <a class="page-link" href="https://vaurenw.github.io/contact.html">Contact</a>
</div>
</nav></div>
</header>

<hr class="tophr">
<div id='wrapper' class="wrapper">
<div id='text1'>
        
<header>
  <h1>New CSP directive to make Subresource Integrity mandatory (`require-sri-for`)</h1>
  <time datetime="2016-06-02T00:00:00+02:00">Thu 02 June 2016</time>
</header>
<article>
    <h3>Background</h3>
<p>GitHub is one of the <a href="http://githubengineering.com/subresource-integrity/">first big webistes using Subresource Integrity</a> and can thus <a href="https://hacks.mozilla.org/2015/09/subresource-integrity-in-firefox-43/">defend against potentially bad Content Delivery Networks (CDNs)</a>.
The tricky thing with SRI is that you have to include it for every HTML tag that points to a CDN if you want the security benefit.
And then, of course, <a href="https://lists.w3.org/Archives/Public/public-webappsec/2015Dec/0045.html">it happend</a> that someone forgot to add this and people were sad. Fortunately, they brought this to the Webappsec Working Group and discussed the matter!</p>
<h4>Omitting the details</h4>
<p>There have been some discussions whether this should be a parameter on <code>script-src</code>, <code>style-src</code> etc. that I would like to omit for the sake of brevity. Feel free to jump into the mailing list (linked previously) if you are curious about this.</p>
<h2>How it works</h2>
<p>It's simple! Just add the directive into your Content Security Policy and specify if you need this for scripts, styles or both: <code>Content-Security-Policy: require-sri-for script style</code></p>
<h4>Example:</h4>
<p>If you are running today's <a href="https://nightly.mozilla.org/">Firefox Nightly</a> (June 2nd, 2016), you should not see an alert box from html5sec.org vising this the PHP script below:</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
<span class="cp">header(&quot;Content-Security-Policy: require-sri-for script style&quot;);</span>
<span class="cp">?&gt;</span>
<span class="cm">&lt;!-- This should load but cause a devtools warning because bootstrap requires jquery --&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js&quot;</span> <span class="na">iintegrity</span><span class="o">=</span><span class="s">&quot;sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS&quot;</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">&quot;anonymous&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="cm">&lt;!-- these shouldn&#39;t load and cause a CSP violation to be reported an alert popup indicates failure. --&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://html5sec.org/test.js&quot;</span> <span class="na">integrity</span><span class="o">=</span><span class="s">&quot;foo&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://html5sec.org/test.js&quot;</span> <span class="na">integrity</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://html5sec.org/test.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</code></pre></div>

<p><small>(Sorry, no public demo URL â˜¹)</small></p>
<h2>Calling for testers</h2>
<p>This feature is relatively new, so we need some feedback from enthusiasts: Please see if you can find this useful in deployment (looking at you, GitHub folks) and you, security testers: Can you load scripts from other origins without integrity even though a <code>require-sri-for</code> policy is in place? But please see my notes on known issues below.</p>
<p>Feel free to look  also into my patch, if you know a thing or two about C++ and Firefox. The implementation was discussed in <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1265318">Bugzilla bug 1265318</a> with the patches attached.</p>
<h2>Known Issues</h2>
<ul>
<li>CSP violation reporting currently complains about the document URL that included the subresource instead of the subresource URL (<a href="(https://bugzilla.mozilla.org/show_bug.cgi?id=1277495)">bug 1277495</a>.</li>
<li><code>&lt;svg:script&gt;</code> is, <em>technically speaking</em>, not the same as HTML's <code>&lt;script&gt;</code>, so there are theoretical bypasses via SVG and other mechanisms that run scripts &amp; styles without <code>&lt;link href&gt;</code> and <code>&lt;script src&gt;</code>. I couldn't bypass this using the obvious svg script tab, but this needs further investigation (<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1277248">bug 1277248</a>).</li>
<li>Firefox doesn't manage to enforce the directive when the CSP is in a <code>&lt;meta&gt;</code> tag (<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1277557">bug 1277557</a>).</li>
</ul>
<h2>Your Feedback</h2>
<p>Please submit your feedback as bugs in <a href="https://bugzilla.mozilla.org/enter_bug.cgi?product=Core&amp;component=DOM%3A%20Security">Bugzilla using this link</a> if you want someone to see it. I will not monitor IRC, Twitter or E-Mail over the next few months, as I am going to be on leave over the summer.</p>
<h3>Acknowledgements</h3>
<p>Thanks to Patrick Toomey from GitHub for raising the issue about SRI enforcement in the first place. Neil Matatall started bringing this into the SRI spec and Sergey Shekyan is currently continuing this. Thanks to the both of you! Thanks to Christoph Kerschbaumer for helping me work on the implementation and Jonathan Hao for doing the <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1235572">groundwork</a>.</p>
</article>

<hr>

<section id="minicontact">
<em>
<!-- Please comment on <a href="https://social.security.plumbing/@freddy">Mastodon</a>. -->
If you find a mistake in this article, you can <a href="https://github.com/freddyb/homepage/edit/main/content/require-sri-for.md">submit a pull request on GitHub</a>.
</em>
</section>

<section id="article-list">
<h4>Recent posts</h4>
<ol>
  <li><a href="https://vaurenw.github.io/madweb-keynote-2025.html">With Carrots & Sticks - Can the browser handle web security?</a>
    <em>(Tue 08 April 2025)</em>
  </li>
  <li><a href="https://vaurenw.github.io/home-assistant-can-not-be-secured-for-internet-access.html">Home assistant can not be secured for internet access</a>
    <em>(Sun 15 December 2024)</em>
  </li>
  <li><a href="https://vaurenw.github.io/modern-solutions-xsleaks.html">Modern solutions against cross-site attacks</a>
    <em>(Tue 26 November 2024)</em>
  </li>
  <li><a href="https://vaurenw.github.io/prompt-injections-and-a-demo.html">Prompt Injections and a demo</a>
    <em>(Wed 18 September 2024)</em>
  </li>
  <li><a href="https://vaurenw.github.io/mozilla-monument.html">The Mozilla Monument in San Francisco</a>
    <em>(Fri 05 July 2024)</em>
  </li>
            
</ol>
</section>
</div>
</div>
</body>
</html>